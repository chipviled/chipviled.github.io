"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function template_iteration(e){return Handlebars.compile('\n    <div class="iteration gallery" data-id="{{id}}">\n      <div class="iteration_title">\n       <div class="iteration_name">{{theme}}</div>\n       {{#if date_begin}}\n         <div class="iteration_date">{{date_begin}} - {{date_end}}</div>\n       {{/if}}\n      </div>\n      <div class="iteration_body" itemscope itemtype="http://schema.org/ImageGallery">\n      \n        {{#each pictures}}\n            <figure class="picture \n                    {{#is_win_null}}picture_win{{/is_win_null}} \n                    {{#if is_voted}}{{else}}picture__not-voted{{/if}} \n                    "\n                    itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">\n                <a href="./data/upload/{{file_path}}/{{file_name}}" \n                        class="picture_body "\n                        itemprop="contentUrl" \n                        data-size="{{pict_width}}x{{pict_height}}">\n                    <img class="b-lazy" \n                        src=data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\n                        data-src="./data/upload/{{file_path}}/thumb_{{file_name}}" \n                        itemprop="thumbnail" alt="pict" />\n                </a>\n                \n                <figcaption itemprop="caption description">\n                <div class="picture_title">{{title}}</div>\n                <div class="picture_username">\n                    <a href="//sonic-world.ru/forum/user/{{user_sity_id}}-{{user_name}}">{{user_name}}</a>\n                </div>\n                </figcaption>\n            </figure>\n        {{/each}}\n        \n      </div>\n    </div>\n    ')(e)}function work(e){var t=document.getElementById("iterations"),n=alasql("\n        SELECT i.*\n        FROM ? i\n        ORDER BY i.date_begin DESC\n        ",[e.iteration]);t.innerHTML="";var i=!0,a=!1,o=void 0;try{for(var r,s=n[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var l=r.value,d=alasql("\n            SELECT p.*, \n              u.name AS user_name, \n              u.sity_id AS user_sity_id,\n              IF(p.is_win > 0, true, NULL) AS is_win_null\n            FROM ? p\n            LEFT JOIN ? u ON u.id = p.user_id\n            WHERE p.iteration_id = ?\n            ORDER BY p.id\n            ",[e.picture,e.users,l.id]);l.pictures=d;var p=document.createElement("li");p.innerHTML=template_iteration(l),t.appendChild(p)}}catch(e){a=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw o}}new Blazy({});new photoswipe_init(".gallery")}function user_pictures_list(e){var t=document.getElementById("iterations"),n=alasql("\n        SELECT u.*, \n          COUNT(p.id) AS count_pictures,\n          u.name AS theme\n        FROM ? u\n        LEFT JOIN ? p ON u.id = p.user_id\n        GROUP BY u.id\n        HAVING COUNT(p.id) > 0\n        ORDER BY COUNT(p.id) DESC;\n        ",[e.users,e.picture]);t.innerHTML="";var i=!0,a=!1,o=void 0;try{for(var r,s=n[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var l=r.value,d=alasql("\n            SELECT p.*, \n              u.name AS user_name, \n              u.sity_id AS user_sity_id,\n              IF(p.is_win > 0, true, NULL) AS is_win_null\n            FROM ? p\n            LEFT JOIN ? u ON u.id = p.user_id\n            WHERE u.id = ?\n            ORDER BY p.id\n            ",[e.picture,e.users,l.id]);l.pictures=d;var p=document.createElement("li");p.innerHTML=template_iteration(l),t.appendChild(p)}}catch(e){a=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw o}}new Blazy({});new photoswipe_init(".gallery")}function top_menu(){document.getElementById("top-menu").innerHTML='\n        <select class="top-menu__wiev-select" v-model="selected" v-on:change="selecting">\n            <option v-for="option in options" v-bind:value="option.value">\n                {{ option.text }}\n            </option>\n        </select>\n    ',new Vue({el:".top-menu__wiev-select",data:{selected:"iteration",options:[{text:"Этапы",value:"iteration"},{text:"Пользователи",value:"user"}]},methods:{selecting:function(e){console.log(">>>",this.selected),"iteration"!==this.selected?"user"!==this.selected||user_pictures_list(window.swtd_data):work(window.swtd_data)}}})}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();void 0===console.log&&(console.log=function(){}),console.log("%c                               \n   Are you like web console?   \n                               ","color:#FFFFFF;background-color:#993399;");var photoswipe_init=function(){function e(t){_classCallCheck(this,e);var n=document.createElement("div");n.innerHTML=this.template_photoswipe(),document.body.appendChild(n),this.initPhotoSwipeFromDOM(t)}return _createClass(e,[{key:"template_photoswipe",value:function(){return'\n        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n            <div class="pswp__bg"></div>\n            <div class="pswp__scroll-wrap">\n                <div class="pswp__container">\n                    <div class="pswp__item"></div>\n                    <div class="pswp__item"></div>\n                    <div class="pswp__item"></div>\n                </div>\n                <div class="pswp__ui pswp__ui--hidden">\n                    <div class="pswp__top-bar">\n                        <div class="pswp__counter"></div>\n                        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>\n                        <button class="pswp__button pswp__button--share" title="Share"></button>\n                        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n                        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n                        <div class="pswp__preloader">\n                            <div class="pswp__preloader__icn">\n                              <div class="pswp__preloader__cut">\n                                <div class="pswp__preloader__donut"></div>\n                              </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n                        <div class="pswp__share-tooltip"></div> \n                    </div>\n                    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">\n                    </button>\n                    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">\n                    </button>\n                    <div class="pswp__caption">\n                        <div class="pswp__caption__center"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    '}},{key:"initPhotoSwipeFromDOM",value:function(e){for(var t=function(e){for(var t,n,i,a,o=e.childNodes,r=o.length,s=[],l=0;l<r;l++)if(1===(t=o[l]).nodeType){n=t.children[0];try{i=n.getAttribute("data-size").split("x")}catch(e){i=[10,10]}a={src:n.getAttribute("href"),w:parseInt(i[0],10),h:parseInt(i[1],10)},t.children.length>1&&(a.title=t.children[1].innerHTML),n.children.length>0&&(a.msrc=n.children[0].getAttribute("src")),a.el=t,s.push(a)}return s},n=function e(t,n){return t&&(n(t)?t:e(t.parentNode,n))},i=function(e,n,i,a){var o,r,s=document.querySelectorAll(".pswp")[0];if(r=t(n),o={galleryUID:n.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(e){var t=r[e].el.getElementsByTagName("img")[0],n=window.pageYOffset||document.documentElement.scrollTop,i=t.getBoundingClientRect();return{x:i.left,y:i.top+n,w:i.width}}},a)if(o.galleryPIDs){for(var l=0;l<r.length;l++)if(r[l].pid==e){o.index=l;break}}else o.index=parseInt(e,10)-1;else o.index=parseInt(e,10);isNaN(o.index)||(i&&(o.showAnimationDuration=0),new PhotoSwipe(s,PhotoSwipeUI_Default,r,o).init())},a=document.querySelectorAll(e),o=0,r=a.length;o<r;o++)a[o].setAttribute("data-pswp-uid",o+1),a[o].onclick=function(e){(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1;var t=e.target||e.srcElement,a=n(t,function(e){return e.tagName&&"FIGURE"===e.tagName.toUpperCase()});if(a){for(var o,r=a.parentNode,s=a.parentNode.childNodes,l=s.length,d=0,p=0;p<l;p++)if(1===s[p].nodeType){if(s[p]===a){o=d;break}d++}return o>=0&&i(o,r),!1}};var s=function(){var e=window.location.hash.substring(1),t={};if(e.length<5)return t;for(var n=e.split("&"),i=0;i<n.length;i++)if(n[i]){var a=n[i].split("=");a.length<2||(t[a[0]]=a[1])}return t.gid&&(t.gid=parseInt(t.gid,10)),t}();s.pid&&s.gid&&i(s.pid,a[s.gid-1],!0,!0)}}]),e}();Promise.all([Vue.http.get("./data/json/picture.json?v="+config.v),Vue.http.get("./data/json/users.json?v="+config.v),Vue.http.get("./data/json/iteration.json?v="+config.v),Vue.http.get("./data/json/achivement.json?v="+config.v),Vue.http.get("./data/json/user_achivement.json?v="+config.v),Vue.http.get("./data/json/user_vote.json?v="+config.v)]).then(function(e){var t={picture:e[0].body,users:e[1].body,iteration:e[2].body,achivement:e[3].body,user_achivement:e[4].body,user_vote:e[5].body};window.swtd_data=t,top_menu(),work(t)},function(e){console.log("Error from load data.",e),document.getElementById("loader").innerHTML="Error from load data. :("});