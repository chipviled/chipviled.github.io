"use strict";var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}void 0===console.log&&(console.log=function(){}),console.log("%c                               \n   Are you like web console?   \n                               ","color:#FFFFFF;background-color:#993399;");var photoswipe_init=function(){function n(e){_classCallCheck(this,n);var t=document.createElement("div");t.innerHTML=this.template_photoswipe(),document.body.appendChild(t),this.initPhotoSwipeFromDOM(e)}return _createClass(n,[{key:"template_photoswipe",value:function(){return'\n        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n            <div class="pswp__bg"></div>\n            <div class="pswp__scroll-wrap">\n                <div class="pswp__container">\n                    <div class="pswp__item"></div>\n                    <div class="pswp__item"></div>\n                    <div class="pswp__item"></div>\n                </div>\n                <div class="pswp__ui pswp__ui--hidden">\n                    <div class="pswp__top-bar">\n                        <div class="pswp__counter"></div>\n                        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>\n                        <button class="pswp__button pswp__button--share" title="Share"></button>\n                        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n                        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n                        <div class="pswp__preloader">\n                            <div class="pswp__preloader__icn">\n                              <div class="pswp__preloader__cut">\n                                <div class="pswp__preloader__donut"></div>\n                              </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n                        <div class="pswp__share-tooltip"></div> \n                    </div>\n                    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">\n                    </button>\n                    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">\n                    </button>\n                    <div class="pswp__caption">\n                        <div class="pswp__caption__center"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    '}},{key:"initPhotoSwipeFromDOM",value:function(e){for(var t=function(e){(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1;var t=function e(t,n){return t&&(n(t)?t:e(t.parentNode,n))}(e.target||e.srcElement,function(e){return e.tagName&&"FIGURE"===e.tagName.toUpperCase()});if(t){for(var n,i=t.parentNode,a=t.parentNode.childNodes,r=a.length,s=0,o=0;o<r;o++)if(1===a[o].nodeType){if(a[o]===t){n=s;break}s++}return 0<=n&&d(n,i),!1}},d=function(e,t,n,i){var a,r,s=document.querySelectorAll(".pswp")[0];if(r=function(e){for(var t,n,i,a,r=e.childNodes,s=r.length,o=[],d=0;d<s;d++)if(1===(t=r[d]).nodeType){n=t.children[0];try{i=n.getAttribute("data-size").split("x")}catch(e){i=[10,10]}a={src:n.getAttribute("href"),w:parseInt(i[0],10),h:parseInt(i[1],10)},1<t.children.length&&(a.title=t.children[1].innerHTML),0<n.children.length&&(a.msrc=n.children[0].getAttribute("src")),a.el=t,o.push(a)}return o}(t),a={galleryUID:t.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(e){var t=r[e].el.getElementsByTagName("img")[0],n=window.pageYOffset||document.documentElement.scrollTop,i=t.getBoundingClientRect();return{x:i.left,y:i.top+n,w:i.width}}},i)if(a.galleryPIDs){for(var o=0;o<r.length;o++)if(r[o].pid==e){a.index=o;break}}else a.index=parseInt(e,10)-1;else a.index=parseInt(e,10);isNaN(a.index)||(n&&(a.showAnimationDuration=0),new PhotoSwipe(s,PhotoSwipeUI_Default,r,a).init())},n=document.querySelectorAll(e),i=0,a=n.length;i<a;i++)n[i].setAttribute("data-pswp-uid",i+1),n[i].onclick=t;var r=function(){var e=window.location.hash.substring(1),t={};if(e.length<5)return t;for(var n=e.split("&"),i=0;i<n.length;i++)if(n[i]){var a=n[i].split("=");a.length<2||(t[a[0]]=a[1])}return t.gid&&(t.gid=parseInt(t.gid,10)),t}();r.pid&&r.gid&&d(r.pid,n[r.gid-1],!0,!0)}}]),n}();function findInArrayObjectById(e,t){return e.id===t?e:null}function returnInArrayObjectById(e,t){return e.find(function(e){return findInArrayObjectById(e,t)})||null}function template_iteration(e){return Handlebars.compile('\n    <div class="iteration gallery" data-id="{{id}}">\n      <div class="iteration_title">\n           {{#if iteration_name}}\n               <div class="iteration_name">{{iteration_name}}</div>\n           {{/if}}\n           {{#if user_name}}\n               <div class="iteration_name">\n                   <a href="//sonic-world.ru/forum/user/{{user_sity_id}}-{{user_name}}">{{user_name}}</a>\n               </div>\n           {{/if}}\n           \n           {{#if date_begin}}\n             <div class="iteration_date">{{date_begin}} - {{date_end}}</div>\n           {{/if}}\n           {{#if count_pictures}}\n             <div class="iteration_info">Рисунков: {{count_pictures}}</div>\n           {{/if}}\n      </div>\n      <div class="iteration_body" itemscope itemtype="http://schema.org/ImageGallery">\n\n        {{#each pictures}}\n            <figure class="picture\n                    {{#is_win_null}}picture_win{{/is_win_null}}\n                    {{#if is_voted}}{{else}}picture__not-voted{{/if}}\n                    "\n                    itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">\n                <a href="./data/upload/{{file_path}}/{{file_name}}"\n                        class="picture_body "\n                        itemprop="contentUrl"\n                        data-size="{{pict_width}}x{{pict_height}}">\n                    <img class="b-lazy"\n                        src=data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\n                        data-src="./data/upload/{{file_path}}/thumb_{{file_name}}"\n                        itemprop="thumbnail" alt="pict" />\n                </a>\n\n                <figcaption itemprop="caption description">\n                <div class="picture_title">{{title}}</div>\n                {{#if user_name}}\n                    <div class="picture_username">\n                        <a href="//sonic-world.ru/forum/user/{{user_sity_id}}-{{user_name}}">{{user_name}}</a>\n                    </div>\n                {{/if}}\n                {{#if picture_iteration_name}}\n                    <div class="picture_iteration_name">\n                        ({{picture_iteration_name}})\n                    </div>\n                {{/if}}\n                </figcaption>\n            </figure>\n        {{/each}}\n\n      </div>\n    </div>\n    ')(e)}function template_table(e){return Handlebars.compile('\n    <div class="iteration iteration_table" data-id="{{id}}">\n      <div class="iteration_title">\n           {{#if title_name}}\n               <div class="title__name">{{title_name}}</div>\n           {{/if}}\n      </div>\n      <div class="iteration_table__body">\n        <table id="tablesort" class="tablesort">\n            <thead>\n                <tr>\n                    <th style="text-align:center;">Имя пользователя</th>\n                    <th style="text-align:center;">Кол. рисунков (общее)</th>\n                    <th style="text-align:center;">Кол. побед</th>\n                    <th style="text-align:center;">Ачивки</th>\n                </tr>\n            </thead>\n            <tbody>\n                {{#each rows}}\n                    <tr>\n                        <td style="text-align:center;">\n                            <a class="iteration_table__link"\n                                href="//sonic-world.ru/forum/user/{{user_sity_id}}-{{user_name}}">{{user_name}}</a>\n                        </td>\n                        <td style="text-align:center;">{{count_pictures}}</td>\n                        <td style="text-align:center;">{{count_wins}}</td>\n                        <td>\n                            {{#each achivements}}\n                                {{#if title}}\n                                    <img class="iteration_table__achivement" \n                                        src="{{image}}" alt="{{title}} - {{description}}"\n                                        title="{{title}} - {{description}}"\n                                        >\n                                {{/if}}\n                            {{/each}}\n                        </td>\n                    </tr>\n                {{/each}}\n            </tbody>\n        </table>\n        <div class="text-gray">* Для сортировки кликнуть по названию колонки</div>\n      </div>\n    </div>\n    ')(e)}function iteration_pictures_list(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n="ASC"===t.iteration_data_by_user?"ASC":"DESC",i="DESC"===t.order_by_picture?"DESC":"ASC",a=document.getElementById("iterations"),r=alasql("\n        SELECT i.*,\n            i.theme AS iteration_name\n        FROM ? i\n        ORDER BY i.date_begin "+n+"\n        ",[e.iteration]),s=!(a.innerHTML=""),o=!1,d=void 0;try{for(var _,u=r[Symbol.iterator]();!(s=(_=u.next()).done);s=!0){var l=_.value,c=alasql("\n            SELECT p.*,\n              u.name AS user_name,\n              u.sity_id AS user_sity_id,\n              IF(p.is_win > 0, true, NULL) AS is_win_null\n            FROM ? p\n            LEFT JOIN ? u ON u.id = p.user_id\n            WHERE p.iteration_id = ?\n            ORDER BY p.id "+i+"\n            ",[e.picture,e.users,l.id]);l.pictures=c;var p=document.createElement("li");p.innerHTML=template_iteration(l),a.appendChild(p)}}catch(e){o=!0,d=e}finally{try{!s&&u.return&&u.return()}finally{if(o)throw d}}new Blazy({});new photoswipe_init(".gallery")}function user_pictures_list(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n="ASC"===t.order_by_user?"ASC":"DESC",i="ASC"===t.order_by_picture?"ASC":"DESC",a=document.getElementById("iterations"),r=alasql("\n        SELECT u.*,\n          COUNT(p.id) AS count_pictures,\n          u.name AS user_name,\n          u.sity_id AS user_sity_id\n        FROM ? u\n        LEFT JOIN ? p ON u.id = p.user_id\n        GROUP BY u.id\n        HAVING COUNT(p.id) > 0\n        ORDER BY COUNT(p.id) "+n+";\n        ",[e.users,e.picture]),s=!(a.innerHTML=""),o=!1,d=void 0;try{for(var _,u=r[Symbol.iterator]();!(s=(_=u.next()).done);s=!0){var l=_.value,c=alasql("\n            SELECT p.*,\n              u.sity_id AS user_sity_id,\n              IF(p.is_win > 0, true, NULL) AS is_win_null,\n              i.theme AS picture_iteration_name\n            FROM ? p\n            LEFT JOIN ? u ON u.id = p.user_id\n            LEFT JOIN ? i ON p.iteration_id = i.id\n            WHERE u.id = ?\n            ORDER BY p.id "+i+"\n            ",[e.picture,e.users,e.iteration,l.id]);l.pictures=c;var p=document.createElement("li");p.innerHTML=template_iteration(l),a.appendChild(p)}}catch(e){o=!0,d=e}finally{try{!s&&u.return&&u.return()}finally{if(o)throw d}}new Blazy({});new photoswipe_init(".gallery")}function user_name_pictures_list(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n="ASC"===t.order_by_user_name?"ASC":"DESC",i="ASC"===t.order_by_picture?"ASC":"DESC",a=document.getElementById("iterations"),r=alasql("\n        SELECT u.*,\n          u.id AS id, \n          u.sity_id AS user_sity_id,\n          u.name AS user_name,\n          COUNT(p.id) AS count_pictures\n        FROM ? u\n        LEFT JOIN ? p ON u.id = p.user_id\n        GROUP BY u.id\n        HAVING COUNT(p.id) > 0\n        ORDER BY u.user_name "+n+"\n        ",[e.users,e.picture]),s=!(a.innerHTML=""),o=!1,d=void 0;try{for(var _,u=r[Symbol.iterator]();!(s=(_=u.next()).done);s=!0){var l=_.value,c=alasql("\n            SELECT p.*,\n              u.sity_id AS user_sity_id,\n              IF(p.is_win > 0, true, NULL) AS is_win_null,\n              i.theme AS picture_iteration_name\n            FROM ? p\n            LEFT JOIN ? u ON u.id = p.user_id\n            LEFT JOIN ? i ON p.iteration_id = i.id\n            WHERE u.id = ?\n            ORDER BY p.id "+i+"\n            ",[e.picture,e.users,e.iteration,l.id]);l.pictures=c;var p=document.createElement("li");p.innerHTML=template_iteration(l),a.appendChild(p)}}catch(e){o=!0,d=e}finally{try{!s&&u.return&&u.return()}finally{if(o)throw d}}new Blazy({});new photoswipe_init(".gallery")}function table_user_achivement(e){(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).order_by_user_name;var t=document.getElementById("iterations"),n=alasql("\n        SELECT u.*,\n          u.id AS id, \n          u.sity_id AS user_sity_id,\n          u.name AS user_name,\n          COUNT(p.id) AS count_pictures,\n          SUM(IF(p.is_win > 0,1,0)) AS count_wins\n        FROM ? u\n        LEFT JOIN ? p ON u.id = p.user_id\n        GROUP BY u.id\n        HAVING COUNT(p.id) > 0\n        ORDER BY count_wins DESC\n        ",[e.users,e.picture,e.user_achivement]);t.innerHTML="";var i={title_name:"Выданные ачивки"};for(var a in i.rows=n,i.rows){var r=alasql("\n            SELECT a.*,\n              IFNULL(image, '#') AS [image]\n            FROM ? a\n            LEFT JOIN ? ua ON a.id = ua.achivement_id\n            LEFT JOIN ? u ON ua.user_id = u.id\n            WHERE u.id = ?\n            GROUP BY a.id\n            ORDER BY a.id ASC\n            ",[e.achivement,e.user_achivement,e.users,i.rows[a].id]);i.rows[a].achivements=r}var s=document.createElement("li");s.innerHTML=template_table(i),t.appendChild(s),new Tablesort(document.getElementById("tablesort"))}function top_menu(){document.getElementById("top-menu").innerHTML='\n        <select class="top-menu__wiev-select" v-model="selected" v-on:change="selecting">\n            <option v-for="option in options" v-bind:value="option.value">\n                {{ option.text }}\n            </option>\n        </select>\n    ',new Vue({el:".top-menu__wiev-select",data:{selected:"iteration_data_by_desc",options:[{text:"Этапы (дата) ASC",value:"iteration_data_by_asc"},{text:"Этапы (дата) DESC",value:"iteration_data_by_desc"},{text:"Пользователи (кол.рисунков) ASC",value:"users_pict_by_asc"},{text:"Пользователи (кол.рисунков) DESC",value:"users_pict_by_desc"},{text:"Пользователи (имя) ASC",value:"users_name_pict_by_asc"},{text:"Пользователи (имя) DESC",value:"users_name_pict_by_desc"},{text:"Сводные данные (таблица)",value:"table_user_achivement_by_asc"}]},methods:{selecting:function(e){switch(this.selected){case"iteration_data_by_desc":iteration_pictures_list(window.swtd_data,{iteration_data_by_user:"DESC"});break;case"iteration_data_by_asc":iteration_pictures_list(window.swtd_data,{iteration_data_by_user:"ASC"});break;case"users_pict_by_asc":user_pictures_list(window.swtd_data,{order_by_user:"ASC"});break;case"users_pict_by_desc":user_pictures_list(window.swtd_data,{order_by_user:"DESC"});break;case"users_name_pict_by_asc":user_name_pictures_list(window.swtd_data,{order_by_user_name:"ASC"});break;case"users_name_pict_by_desc":user_name_pictures_list(window.swtd_data,{order_by_user_name:"DESC"});break;case"table_user_achivement_by_asc":table_user_achivement(window.swtd_data,{order_by_user_name:"ASC"})}}}})}Promise.all([Vue.http.get("./data/json/picture.json?v="+config.v),Vue.http.get("./data/json/users.json?v="+config.v),Vue.http.get("./data/json/iteration.json?v="+config.v),Vue.http.get("./data/json/achivement.json?v="+config.v),Vue.http.get("./data/json/user_achivement.json?v="+config.v),Vue.http.get("./data/json/user_vote.json?v="+config.v)]).then(function(e){var t={picture:e[0].body,users:e[1].body,iteration:e[2].body,achivement:e[3].body,user_achivement:e[4].body,user_vote:e[5].body};window.swtd_data=t,top_menu(),iteration_pictures_list(t)},function(e){console.log("Error from load data.",e),document.getElementById("loader").innerHTML="Error from load data. :("});